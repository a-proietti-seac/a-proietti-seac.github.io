<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="coi-serviceworker.js"></script>
</head>

<body>
    <div id="list" contenteditable></div>
    <button id="check">check</button>
    <div id="available"></div>

    <script>
        /**
            @param {string} username
            @returns {Promise<{ username: string; exists: boolean; }>}
        */
        async function checkGithubExists(username) {
            return fetch(`https://github.com/${username}`)
                .then(r => r.status == 200)
                .then(exists => ({ username, exists }))
        }

        /** @type {HTMLDivElement?} */
        const list = document.querySelector("#list")

        /** @type {HTMLButtonElement?} */
        const check = document.querySelector("#check")

        /** @type {HTMLDivElement?} */
        const available = document.querySelector("#available")

        check.onclick = async () => {
            const responses = await Promise.all(
                list.innerText
                    .split("\n")
                    .filter(line => line != "")
                    .map(checkGithubExists)
            )

            console.log(responses)

            available.innerText = responses
                .filter(v => !v.exists)
                .map(v => v.username)
                .join("\n")

        }

    </script>
</body>

</html>